angular.module('baseApp.shared.blades', ['js/shared/directives/blades/_blade.html']);

angular.module("js/shared/directives/blades/_blade.html", []).run(["$templateCache", function($templateCache) {
  $templateCache.put("js/shared/directives/blades/_blade.html",
    "<div class=\"blade visible\" ng-class=\"getStyle()\" ng-style=\"{width:bladeTypeScope.width}\">\n" +
    "    <div class=\"controls\" ng-style=\"{width:bladeTypeScope.width}\">\n" +
    "\n" +
    "        <span class=\"ico close-ico\" ng-click=\"close()\"></span>\n" +
    "        <span class=\"ico\" ng-click=\"toggleState()\" ng-class=\"{'maximize-ico':state !== 'maximized', 'restore-ico':state === 'maximized'}\"></span>\n" +
    "        <span ng-click=\"minimized()\" class=\"ico minimize-ico\"></span>\n" +
    "        <span class=\"title\">{{::bladeTypeScope.title}}</span>\n" +
    "    </div>\n" +
    "    <div class=\"inner-blade-header\" ng-click=\"open()\">\n" +
    "        <h4 class=\"blade-header\">{{::bladeTypeScope.title}}</h4>\n" +
    "    </div>\n" +
    "   <span class=\"content\" ng-style=\"{width:bladeTypeScope.width}\"></span>\n" +
    "</div>");
}]);

angular.module("baseApp.shared").factory("bladeService",["uuid",function(a){"use strict";var b={},c={},d={},e=[],f=function(a){for(var b=_.find(e,function(b){return b.id===a}),c=e.indexOf(b),d=e.length,f=0;d-1-c>f;f++)e.pop()};return{activeBlades:e,addNewActiveBlade:function(c,d,f,g){var h=_.clone(b[c]);h.id=a.generate(),h.params=f,g&&(h.title=g),d&&(h.defaultState=d),e.push(h)},setMaxBlade:function(a){c.bladeTypeScope&&c.bladeTypeScope.id!==a.bladeTypeScope.id&&c.open(),c!==a&&(c=a)},generateUrl:function(){return e.reduce(function(a,b){return a+b.typeName+"/"+b.state+"/"},"")},setUrl:function(a){for(var b=a.split("/"),c=0;c<b.length;){var e=b[c++],f=b[c++];d[e]={},d[e].state=f}},getMaxBlade:function(){return c},destroyBlades:function(){c={},d={},b={},e.length=0},addType:function(a,c){b[a.typeName]=a,b[a.typeName].template=c,d[a.typeName]&&this.addNewActiveBlade(b[a.typeName]),"open"===a.defaultState&&this.addNewActiveBlade(a.typeName,"open")},closeBladeById:function(a){f(a);var b=_.find(e,function(b){return b.id===a});e.splice(e.indexOf(b),1)},closeBlade:function(a){f(a.id),e.splice(e.indexOf(a),1)},open:function(a,b,c,d){var g=_.find(e,function(b){return b.id===a});e.indexOf(g)<e.length-1&&f(a),this.addNewActiveBlade(b,"open",c,d)}}}]);
angular.module("baseApp.shared").directive("blades",["bladeService","$compile",function(a,b){"use strict";return{restrict:"E",transclude:!0,replace:!0,bindToController:!0,controllerAs:"bladesCtrl",controller:["$scope","$element",function(b,c){var d=this;c=angular.element(c[0].querySelector(".blades")),d.bladeManagement=a,d.scrollBladeIntoView=function(a,b){var d=c[0].getBoundingClientRect(),e=a[0].getBoundingClientRect();"left"===b?c[0].scrollLeft=e.left-d.left+c[0].scrollLeft:c[0].scrollLeft=e.right-d.right+c[0].scrollLeft},d.isBladeInView=function(a){var b=c[0].getBoundingClientRect(),d=a[0].getBoundingClientRect();return d.right<b.right},d.calculateShadows=function(a){var e=d.leftShadow,f=d.rightShadow;d.leftShadow=c[0].scrollLeft>0,d.rightShadow=c[0].scrollWidth>c[0].parentElement.clientWidth&&c[0].scrollLeft+c[0].clientWidth!==c[0].scrollWidth,a&&"boolean"==typeof a||(e!==d.leftShadow||f!==d.RightShadow)&&b.$apply()},c.bind("scroll",d.calculateShadows)}],template:'<div class="blades-outer" ng-class="{\'left-shadow\':bladesCtrl.leftShadow, \'right-shadow\':bladesCtrl.rightShadow}"><div class="blades" ng-transclude></div></div>',link:function(c,d){d=angular.element(d[0].querySelector(".blades")),d.empty(),d.append('<blade ng-repeat="activeBlade in bladesCtrl.bladeManagement.activeBlades track by activeBlade.id" is-last="$last" blade-type-scope="activeBlade"></blade>'),b(d.children())(c),c.$on("$destroy",function(){a.destroyBlades()})}}}]).directive("blade",["$timeout","$location","bladeService",function(a,b,c){"use strict";return{restrict:"E",replace:!0,scope:{bladeTypeScope:"=",isLast:"="},templateUrl:"js/shared/directives/blades/_blade.html",require:["^blades","blade"],controller:["$scope",function(a){var b=this;b.calleeInfo=a.bladeTypeScope.params,b.id=a.bladeTypeScope.id,b.maximized="maximized"!==a.bladeTypeScope.defaultState,a.state=_.isUndefined(a.defaultState)?"minimized":a.defaultState,a.open=function(c){"open"!==a.state&&(a.state="open",b.calleeInfo=c)},a.minimized=function(){a.state="minimized"}}],link:function(b,d,e,f){var g=f[0],h=f[1];b.bladeTypeScope.template(b,function(a){for(var b=d[0].querySelector("span.content"),c=0;c<a.length;c++)b.appendChild(a[c])}),b.state=b.bladeTypeScope.defaultState,b.$watch("state",function(a){g.calculateShadows(!0),h.maximized="maximized"===a}),b.$watch("isLast",function(b){b&&a(function(){g.scrollBladeIntoView(d,"right")},0,!1)}),b.close=function(){c.closeBlade(b.bladeTypeScope)},b.getStyle=function(){return b.state+(b.isLast?" last":"")},b.toggleState=function(){"maximized"===b.state?b.state="open":b.maximize()},b.maximize=function(){b.state="maximized",g.bladeManagement.setMaxBlade(b),a(function(){g.scrollBladeIntoView(d,"left")},0,!1)}}}}]).directive("bladeType",["bladeService",function(a){"use strict";return{restrict:"E",require:"^blades",transclude:!0,bindToController:!0,replace:!0,controllerAs:"bladeTypeCtrl",scope:{title:"@",width:"@",defaultState:"@",typeName:"@"},template:'<div class="content"></div>',controller:["$scope","$element","$attrs","$transclude",function(b,c,d,e){a.addType(b.bladeTypeCtrl,e)}]}}]);