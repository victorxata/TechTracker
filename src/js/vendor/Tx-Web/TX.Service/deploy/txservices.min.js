angular.module("txServices.resources",["txServices.common"]),angular.module("txServices.resources").factory("accountService",["$http","$window","Restangular","baseRoute","url",function(a,b,c,d,e){var f=c.all("userprofile");return{token:function(b,c){var f={username:b,password:c,grant_type:"password"};return a.post(d.apiRoute()+"/Token",e.encodeFromObject(f),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},changePassword:function(a,b,c){return f.customPOST({newPassword:a,confirmPassword:b,oldPassword:c},"changePassword",{},{TenantId:!1})},setPassword:function(a,b,c,d){return f.customPOST({userName:a,password:b,confirmPassword:c,token:d},"setPassword")},getExternalProviders:function(){return f.customGETLIST("externallogins",{returnUrl:d.webRoute()+"/externalregister",generateState:!0},{TenantId:!1})},getUserExternalProviders:function(){return f.customGET("manageinfo",{returnUrl:d.webRoute()+"/settings/networks",generateState:!0},{TenantId:!1})},externalUserExists:function(){return f.customGET("externaluserexists")},getPregisteredUser:function(a){return f.customGET("registration",{token:a})},externalRegistration:function(a,b,c,d,e,g){return f.customPOST({username:a,email:b,realName:c,imageUrl:d,language:e,country:g},"externalregistration")},addExternalLogin:function(a){return f.customPOST({ExternalAccessToken:a},"addexternallogin")},removeExternalLogin:function(a,b){return f.customPOST({loginProvider:a,providerKey:b},"removelogin")},saveRegistration:function(a){return f.customPOST(a,"registration")},uploadImage:function(b){return a({method:"POST",url:d.apiRoute()+"/api/images/uploadimage",data:b,headers:{"Content-Type":void 0},transformRequest:function(a){return a}})},getUserForPasswordRecovery:function(a){return f.customGET("recoverpassword/"+a)},userForPasswordRecovery:function(a){return f.customPOST({},"rememberMe/"+a)},savePregistration:function(a){return a.language=b.navigator.language,f.customPOST(a,"preregistration")}}}]),angular.module("txServices.resources").factory("contentProcessingSequencesService",["Restangular","txList",function(a,b){"use strict";var c=a.all("sequences"),d=new b;return c.getList().then(function(a){d.addArray(a.plain())}),{contentProcessorSequences:function(){return d},contentProcessorSequence:function(a){return d.findBy("id",a)}}}]),angular.module("txServices.resources").factory("countryLanguageService",["Restangular","$window",function(a,b){var c=a.all("languages");return{getCountryLanguages:function(){return c.withHttpConfig({cache:!0}).customGET(_.isUndefined(b.navigator.language)?"initialdata/en-US":"initialdata/"+b.navigator.language)}}}]),angular.module("txServices.resources").factory("profileService",["Restangular",function(a){"use strict";var b=a.all("userprofile/profile");return{getProfile:function(){return b.customGET("",{},{TenantId:!1}).then(function(a){return a.birthday=new Date(a.birthday),a})},getTenants:function(a){return b.one(""+a).withHttpConfig({cache:!0}).getList("tenants",{},{TenantId:!1})}}}]),angular.module("txServices.resources").factory("sessionService",["loginState","homeState","localStorageService","$q","$state","accountService","profileService","countryLanguageService","gettextCatalog",function(a,b,c,d,e,f,g,h,i){"use strict";var j={token:"",expires:0},k={id:"",userName:"",password:"",image:"",realName:"",currentTenant:"",webSiteLanguage:""},l=b,m=function(){j=c.get("token"),k=c.get("userInfo"),j&&k||p()},n=function(a,b,c){var d=a.isoCode;return i.currentLanguage!==d&&(i.setCurrentLanguage(d),void 0===d&&"en-us"!==d.toLowerCase())?i.loadRemote("/languages/"+d.toLowerCase()+".json").then(b,c):void 0},o=function(a){C(a),n(a,angular.noop,function(){throw Error("Language "+a.englishName+" is not supported")})},p=function(){j={token:"",expires:0},k={id:"",userName:"",password:"",image:"",realName:"",currentTenant:"",webSiteLanguage:""}},q=function(){return l},r=function(a){l=a},s=function(){c.set("token",j),c.set("userInfo",k)},t=function(){c.remove("token"),c.remove("userInfo")},u=function(){var a=d.defer();return m(),J()?K()?a.resolve(j.token):a.reject():a.resolve(j.token),a.promise},v=function(){return j.token},w=function(){return k.userName},x=function(){return k.currentTenant},y=function(){return k.id},z=function(a){k.id=a,s()},A=function(a,b){j.token=a,j.expires=(new Date).getTime()+1e3*b,s()},B=function(a,b,c,d,e){k.userName=a,k.image=b,k.realName=c,d&&(k.password=d),e&&(k.currentTenant=e),s()},C=function(a){k.webSiteLanguage=a,s()},D=function(a){k.password=a,s()},E=function(a){k.image=a,s()},F=function(a){k.realName=a,s()},G=function(a){k.currentTenant=a,s()},H=function(){var b=d.defer();return m(),k.id&&""!==k.id?(n(k.webSiteLanguage),b.resolve(k)):L().then(function(a){k.id=a.id,z(a.id),B(a.userName,a.imageUrl,a.realName),o(a.webSiteLanguage),s(),b.resolve(k)},function(){t(),e.go(a),b.reject()}),b.promise},I=function(){t(),p(),H()},J=function(){if(m(),""===j.token)return!0;var a=j.expires;return a<(new Date).getTime()},K=function(){f.token(k.userName,k.password).then(function(a){return j.token=a.data.access_token,j.expires=(new Date).getTime()+1e3*a.data.expires_in,k.userName=a.data.userName,s(),!0},function(){return t(),e.go(a),!1})},L=function(){return g.getProfile()},M=function(b,c){var g=d.defer();return f.token(b,c).then(function(a){j.token=a.data.access_token,j.expires=(new Date).getTime()+1e3*a.data.expires_in,k.userName=a.data.userName,s(),g.resolve(),e.go(l)},function(b){t(),g.reject(b),e.go(a)}),g.promise},N=function(){t(),p(),e.go(a)},O={getToken:v,getTokenPromise:u,setToken:A,needNewToken:J,getNextState:q,setNextState:r,setUserInfo:B,getUserInfo:H,refreshUserInfo:I,getId:y,setId:z,getUserName:w,setPassword:D,setRealName:F,setImage:E,getTenant:x,setTenant:G,logIn:M,logout:N,setWebSiteLanguage:o};return O}]),angular.module("txServices.common",[]),angular.module("txServices.common").factory("baseRoute",["$location","baseRouteConfig",function(a,b){"use strict";function c(){return b}function d(){var b=a.protocol()+"://"+a.host()+":"+a.port();return b}var e={apiRoute:c,webRoute:d,hasBase:function(b){return b.search(a.host())>-1}};return e}]),angular.module("txServices.common").factory("element",function(){"use strict";return{isElementInViewport:function(a,b){var c=a[0].getBoundingClientRect();return{pastTop:c.top<=b[0].getBoundingClientRect().top,pastBottom:c.bottom>=b[0].getBoundingClientRect().bottom}}}}),angular.module("txServices.common").factory("txList",function(){"use strict";var a=function(){Array.call(this)};return a.prototype=Object.create(Array.prototype),a.prototype.constructor=a,a.prototype.removeItem=function(a){this.splice(this.indexOf(a),1)},a.prototype.remove=function(a){this.splice(a,1)},a.prototype.addRange=function(a){for(var b=0;b<a.length;b++)this.push(a[b])},a.prototype.findBy=function(a,b){for(var c=0;c<this.length;c++)if(this[c][a]===b)return this[c]},a.prototype.removeAll=function(a){if(a)for(var b=0;b<a.length;b++)this.removeItem(a[b]);else this.length=0},a.prototype.addArray=function(a){this.length=0,this.addRange(a)},a}),angular.module("txServices.common").factory("objectService",function(){"use strict";return{getPropValue:function(a,b){return _.reduce(b.split("."),function(a,b){return a[b]},a)}}}),angular.module("txServices.common").factory("url",function(){"use strict";return{encodeFromObject:function(a){if(!angular.isObject(a))return null===a?"":a.toString();var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(null===d?"":d))}var e=b.join("&").replace(/%20/g,"+");return e}}}),angular.module("txServices.common").factory("uuid",function(){"use strict";return{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}});